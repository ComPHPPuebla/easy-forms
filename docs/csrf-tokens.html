<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Easy form handling for PHP</title>

        <link rel="stylesheet" href="http://ComPHPPuebla.github.io/easy-forms/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://ComPHPPuebla.github.io/easy-forms/css/font-awesome.min.css">
        <link rel="stylesheet" href="http://ComPHPPuebla.github.io/easy-forms/css/highlight.tomorrow-night.css">
        <link rel="stylesheet" href="http://ComPHPPuebla.github.io/easy-forms/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="http://ComPHPPuebla.github.io/easy-forms/">
                Easy form handling for PHP
                <small class="hidden-xs hidden-sm">
                    Decoupled form processing
                </small>
            </a>

            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

                                                    <p class="text-muted">
                                Easy Form
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="http://ComPHPPuebla.github.io/easy-forms/docs/installation.html">
                                            Installation
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://ComPHPPuebla.github.io/easy-forms/docs/creating-elements.html">
                                            Creating form elements
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://ComPHPPuebla.github.io/easy-forms/docs/creating-forms.html">
                                            Creating forms
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://ComPHPPuebla.github.io/easy-forms/docs/validating-forms.html">
                                            Validating forms
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://ComPHPPuebla.github.io/easy-forms/docs/rendering-forms.html">
                                            Rendering forms
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://ComPHPPuebla.github.io/easy-forms/docs/csrf-tokens.html">
                                            CSRF tokens
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://ComPHPPuebla.github.io/easy-forms/docs/captcha-elements.html">
                                            CAPTCHA elements
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://ComPHPPuebla.github.io/easy-forms/docs/dynamic-modification.html">
                                            Dynamic modification
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://ComPHPPuebla.github.io/easy-forms/docs/code-generation.html">
                                            Generating code
                                        </a>
                                    </li>
                                                            </ul>
                        
                    </nav>

                
                <section class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1>CSRF tokens</h1>
<p>In order to protect your application from Cross Site Request Forgery (CSRF) attacks
you can generate and validate secret tokens and include them in your forms. This
package integrates the Symfony Security CSRF package to do that task.</p>
<p>Let's add a CSRF token to the <code>LoginForm</code> used in previous examples.</p>
<pre><code class="language-php">use EasyForms\Elements\Csrf\TokenProvider;
use EasyForms\Elements\Text;
use EasyForms\Elements\Password;
use EasyForms\Elements\Csrf;
use EasyForms\Form;

class LoginForm extends Form
{
    public function __construct(TokenProvider $csrfTokenProvider)
    {
        $this
            -&gt;add(new Text('username'))
            -&gt;add(new Password('password'))
            -&gt;add(new Csrf('csrf_token', '_login_csrf_token', $csrfTokenProvider))
        ;
    }
}</code></pre>
<p>A <code>Csrf</code> form element requires a name (as any element) an identifier for the token
and a <code>TokenProvider</code> object. We can configure a Symfony2 token provider as follows:</p>
<pre><code class="language-php">use EasyForms\Bridges\Symfony\Security\CsrfTokenProvider;
use Symfony\Component\Security\Csrf\CsrfTokenManager;
use Symfony\Component\Security\Csrf\TokenGenerator\UriSafeTokenGenerator;
use Symfony\Component\Security\Csrf\TokenStorage\NativeSessionTokenStorage;

$loginform = new LoginForm(new CsrfTokenProvider(
   new CsrfTokenManager(new UriSafeTokenGenerator(), new NativeSessionTokenStorage())
));</code></pre>
<p>You could validate the token adding a validator to the <code>LoginFilter</code> object showed in
previous examples.</p>
<pre><code class="language-php">use EasyForms\Bridges\Zend\InputFilter\Validator\CsrfValidator;
use EasyForms\Elements\Csrf\TokenProvider;
use Zend\InputFilter\Input;
use Zend\InputFilter\InputFilter;

class LoginFilter extends InputFilter
{
    public function __construct(TokenProvider $tokenProvider)
    {
        $this
            /* ... */
            -&gt;add($this-&gt;buildCsrfInput($tokenProvider))
        ;
    }

    /* ... */

    protected function buildCsrfInput(TokenProvider $tokenProvider)
    {
        $csrf = new Input('csrf_token');
        $csrf-&gt;setContinueIfEmpty(true);
        $csrf
            -&gt;getValidatorChain()
            -&gt;attach(new CsrfValidator([
                'tokenProvider' =&gt; $tokenProvider,
                'tokenId' =&gt; '_login_csrf_token',
                'updateToken' =&gt; true,
            ]))
        ;

        return $csrf;
    }
}</code></pre>
<p>Now you could validate your form as usual. Note that this form element does not
require special treatment in the template since it is a simple <code>hidden</code> element.</p>
                </section>

            </div>
        </main>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
